# ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import os;
from random import random;
import test as t;
from test import test as t2, test2 as t3;

struct Point {
    x: int64;
    y: int64;
    title: str?;
}

# ğŸ”¹ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¯ãƒ©ã‚¹
class Utils {
    static def getCurrentTimestamp() -> uint64 {
        return 1700000000;  # ä»®ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    }

    static def hashPassword(password: str) -> str {
        return f"hashed_{password}";
    }

    static def getServerName() -> str {
        const name = "MainServer";
        return name;
    }
}

# ğŸ”¹ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚å®šæ•°ï¼ˆconst: ãƒ“ãƒ«ãƒ‰æ™‚ã«æ±ºå®šã€å¤‰æ›´ä¸å¯ï¼‰
const maxUsers: uint32 = 100;
const version = "1.0.0"; # å‹ã‚’æŒ‡å®šã—ãªã„å ´åˆã¯è‡ªå‹•çš„ã«æ¨è«–ã•ã‚Œã‚‹
const pi: float32 = 3.14159;

# ğŸ”¹ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ï¼ˆenumï¼‰
enum Role {
    admin,
    user,
    guest
}

# ğŸ”¹ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒ©ã‚¹
class User {
    final username: str;
    private final passwordHash: str;
    final age: uint8;
    final role: Role;
    final userId: uint64;  # å®Ÿè¡Œæ™‚ã«æ±ºå®šã—ã€å¤‰æ›´ä¸å¯
    let handler: (function(uint64, uint32) -> ((str | uint32)?, str))?;

    static let userCount: uint64 = 0;

    def __init__(self, username: str, password: str, age: uint8, role: Role) {
        self.username = username;
        self.passwordHash = Utils.hashPassword(password);
        self.age = age;
        self.role = role;
        self.userId = Utils.getCurrentTimestamp();  # å®Ÿè¡Œæ™‚ã«æ±ºå®šã—ã€å¤‰æ›´ä¸å¯
        User.userCount += 1;  # staticå¤‰æ•°ã®æ›´æ–°
    }

    # å½¹å‰²ã‚’è¿”ã™é–¢æ•°ï¼ˆswitch æ–‡ï¼‰
    def getRoleName() -> str {
        switch self.role {
            case .admin { return "Administrator"; }
            case .user { return "Regular User"; }
            case .guest { return "Guest User"; }
            default { return "Unknown"; }
        }
    }

    def setHandler(self, handler: function(uint64) -> str) -> None {
        self.handler = handler;
    }

    # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯ï¼ˆprivate defï¼‰
    private def checkPassword(self, inputPassword: str) -> bool {
        return self.passwordHash == Utils.hashPassword(inputPassword);
    }

    # ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
    def login(self, inputPassword: str) -> bool {
        return self.checkPassword(inputPassword);
    }
}

# ğŸ”¹ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚¯ãƒ©ã‚¹
class UserManager {
    const name = "UserManager";
    static let users: [User] = [];
    static let userIds: [str] = ["Alice", "Bob", "Charlie"];

    # æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ 
    static def addUser(username: str, password: str, age: uint8, role: Role) -> str {
        '''
        æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ ã—ã¾ã™ã€‚
        :param username: ãƒ¦ãƒ¼ã‚¶ãƒ¼å
        :param password: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
        :param age: å¹´é½¢
        :param role: å½¹å‰²
        :return: å‡¦ç†çµæœ
        '''
        if UserManager.users.length >= maxUsers {
            return "User limit reached!";
        }
        final newUser = User(username, password, age, role);
        UserManager.users.append(newUser);
        return f"User {username} added successfully!";
    }

    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
    static def listUsers() -> None {
        for user in UserManager.users {
            print(f"{user.username} ({user.age} years old) - {user.getRoleName()}");
        }
    }

    @deprecated
    def removeUser(self, username: str) -> str {
        for i in 0..<UserManager.users.length {
            if UserManager.users[i].username == username {
                UserManager.users.removeAt(i);
                return f"User {username} removed successfully!";
            }
        }
        return "User not found!";
    }
}

class TestUser(User) {
    pass;
}

# ğŸ”¹ ãƒ¡ã‚¤ãƒ³å‡¦ç†
final serverName = Utils.getServerName();  # å®Ÿè¡Œæ™‚ã«æ±ºå®š
final startTime = Utils.getCurrentTimestamp();  # å®Ÿè¡Œæ™‚ã«æ±ºå®š

UserManager.addUser("Alice", "password123", 30, .admin);
UserManager.addUser("Bob", "securepass", 25, .user);
UserManager.addUser("Charlie", "guest", 22, .guest);

UserManager.listUsers();

# âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³
final user: User? = UserManager.users[0];

if final user = user {
    print(user!.login("password123"));  # True
}
user?.setHandler({ userId in
    return f"Message sent to {userIds}: {message}";
})

# âœ… Noneå®‰å…¨ãƒã‚§ãƒƒã‚¯
final optionalUser: User? = None;
print(optionalUser ?? "No user found.");  # "No user found."

guard final user = optionalUser else {
    print("User not found.");
    exit(1);
}

# âœ… ãƒ©ãƒ ãƒ€å¼
final square = (x: uint32) => x * x;
final cube = (x: uint32) {
    return x ** 3;
};
print(square(5));  # 25

# âœ… ã‚¿ãƒ—ãƒ« & è¾æ›¸
final userData: {str: uint8} = {"Alice": 30, "Bob": 25};
let userInfo: (str, uint8) = ("Charlie", 22);  # let ã§ä¸€éƒ¨å¯å¤‰è¦ç´ 
print(userData["Alice"]);  # 30
print(userInfo[0]);  # "Charlie"

# âœ… å¤‰æ›´å¯èƒ½ãªä¸€éƒ¨ãƒ‡ãƒ¼ã‚¿
let counter: uint32 = 0;
for i in 0..<10 {
    counter += 1;
}
print(f"Counter: {counter}");

final test = !(true && (1 + 1 > 0));

# âœ… ä¾‹å¤–å‡¦ç†
try {
    let result: uint32 = 10 / 0;
} catch e: ZeroDivisionError {
    print("Cannot divide by zero.");
} catch e: Exception {
    print("An error occurred: " + e.message);
} finally {
    print("Execution completed.");
}

try {
    throw Exception("Custom error message.");
} catch e: Exception {
    print("An error occurred: " + e.message);
}

# âœ… ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®åˆ©ç”¨
print(os.getcwd());
print(random());

@app.route("/hello")
def hello() -> str {
    return "Hello, World!";
}
